<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.1" />
<title>bridge_sim.util API documentation</title>
<meta name="description" content="A collection of potentially useful functions." />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>bridge_sim.util</code></h1>
</header>
<section id="section-intro">
<p>A collection of potentially useful functions.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;A collection of potentially useful functions.&#34;&#34;&#34;

from __future__ import annotations

import os
import math
from typing import Union, List

import findup
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import portalocker
from colorama import init
from scipy.interpolate import interp1d
from termcolor import colored

init()


kg_to_kn = 0.00980665
&#34;&#34;&#34;Multiply by this to convert kg to kN.&#34;&#34;&#34;
kn_to_kg = 1 / kg_to_kn
&#34;&#34;&#34;Multiply by this to convert kN to kg.&#34;&#34;&#34;


def convert_times(f: str, t: str, times: List[float]):
    &#34;&#34;&#34;Convert time series from one unit to another.&#34;&#34;&#34;
    second, day = &#34;second&#34;, &#34;day&#34;
    if f == day and t == second:
        return np.array(times) * 86400
    if f == second and t == day:
        return np.array(times) / 86400
    raise ValueError(f&#34;Unrecognized: {f}, {t}&#34;)


def apply(effect: List[float], signal: List[float]):
    &#34;&#34;&#34;Given effect interpolated to length of given signal.

    Args:
        effect: temperature effect to interpolate to signal length.
        signal: the signal, length of which temperature is interpolated to.

    &#34;&#34;&#34;
    i = interp1d(
        np.linspace(0, len(signal) - 1, 10000), np.linspace(0, len(effect) - 1, 10000),
    )(np.arange(len(signal)))
    return interp1d(np.arange(len(effect)), effect)(i)


def project_dir():
    &#34;&#34;&#34;Root directory of the project (looks for .git file).&#34;&#34;&#34;
    return os.path.dirname(findup.glob(&#34;.git&#34;))


def log(c: &#34;Config&#34;, s):
    &#34;&#34;&#34;Write a string to a log file.&#34;&#34;&#34;
    with open(c.get_data_path(&#34;log&#34;, &#34;log.txt&#34;), &#34;a&#34;) as f:
        f.write(&#34;\n&#34; + s)


def assert_sorted(l):
    &#34;&#34;&#34;Assert a list is sorted.&#34;&#34;&#34;
    assert all(l[i] &lt;= l[i + 1] for i in range(len(l) - 1))


# The letters that come after a number e.g. in 1st, 2nd, 3rd.
st = lambda n: &#34;%s&#34; % (
    &#34;tsnrhtdd&#34;[(np.floor(n / 10) % 10 != 1) * (n % 10 &lt; 4) * n % 10 :: 4]
)


def flatten(container, t: type):
    &#34;&#34;&#34;Flatten into a list of elements of type t.&#34;&#34;&#34;

    def _flatten(container, t):
        for i in container:
            if isinstance(i, t):
                yield i
            else:
                for j in _flatten(i, t):
                    yield j

    return list(_flatten(container, t))


def round_m(x):
    &#34;&#34;&#34;Round meters to an accuracy that avoids machine error.&#34;&#34;&#34;
    return np.around(x, decimals=6)


def print_d(debug: Union[bool, str], s: str, *args, **kwargs):
    &#34;&#34;&#34;Print some debug text.&#34;&#34;&#34;
    if debug:
        path_str = &#34;&#34;
        if isinstance(debug, str):
            path_str = debug
        print(colored(f&#34;DEBUG: {path_str}: {s}&#34;, &#34;yellow&#34;), *args, **kwargs)


def print_i(s: str, *args, **kwargs):
    &#34;&#34;&#34;Print some info text.&#34;&#34;&#34;
    print(colored(f&#34;INFO: {s}&#34;, &#34;green&#34;), *args, **kwargs)


def print_s(s: str):
    &#34;&#34;&#34;Print some special info text.&#34;&#34;&#34;
    print(colored(f&#34;INFO: {s}&#34;, &#34;cyan&#34;))


def print_w(s: str):
    &#34;&#34;&#34;Print some warning text.&#34;&#34;&#34;
    print(colored(f&#34;WARN: {s}&#34;, &#34;red&#34;))


def nearest_index(array, value):
    &#34;&#34;&#34;Return the index of the nearest value in a sorted array.&#34;&#34;&#34;
    i = np.searchsorted(array, value, side=&#34;left&#34;)
    if i &gt; 0 and (
        i == len(array) or math.fabs(value - array[i - 1]) &lt; math.fabs(value - array[i])
    ):
        return i - 1
    else:
        return i


def shorten_path(c: Config, filepath: str, bypass_config: bool = False) -&gt; str:
    &#34;&#34;&#34;Shorten path by mapping to a shorter filepath via a metadata file.&#34;&#34;&#34;
    if not bypass_config and not c.shorten_paths:
        return filepath
    df_path = c.get_data_path(&#34;metadata&#34;, &#34;filepath-shortening-map.txt&#34;)
    lock_path = df_path + &#34;.lock&#34;

    # Acquire an exclusive file lock.
    with portalocker.Lock(lock_path, flags=portalocker.LOCK_EX) as f:

        def flush():
            &#34;&#34;&#34;Ensure all results are written back before exiting &#39;with&#39;.&#34;&#34;&#34;
            f.flush()
            os.fsync(f.fileno())

        if os.path.exists(df_path):
            df = pd.read_csv(df_path, index_col=0)
        else:
            df = pd.DataFrame(columns=[&#34;original&#34;, &#34;short&#34;])
        existing_row = df[df[&#34;original&#34;] == filepath]
        if len(existing_row) == 1:
            return str(existing_row[&#34;short&#34;].iloc[0])
        elif len(existing_row) &gt; 1:
            raise ValueError(f&#34;Duplicate rows in metadata file: row = {filepath}&#34;)
        short = len(df.index) + 1
        short = os.path.join(
            os.path.dirname(filepath),
            &#34;short&#34; + str(short) + os.path.splitext(filepath)[1],
        )
        if not os.path.exists(os.path.dirname(short)):
            os.makedirs(os.path.dirname(short))
        df = df.append({&#34;original&#34;: filepath, &#34;short&#34;: short}, ignore_index=True)
        df.to_csv(df_path)
        flush()
    print_i(f&#34;Shortened path to: {short}&#34;)
    return short


def clean_generated(c: &#34;Config&#34;):
    &#34;&#34;&#34;Remove generated files but keep folders.&#34;&#34;&#34;
    print_w(f&#34;Removing all files in: {c.generated_data_dir}&#34;)

    def clean_dir(dir_path):
        for root, dir_names, file_names in os.walk(dir_path):
            for file_name in file_names:
                print_i(f&#34;Removing {file_name}&#34;)
                os.remove(os.path.join(root, file_name))
            for dir_name in dir_names:
                clean_dir(os.path.join(root, dir_name))

    clean_dir(c.generated_data_dir())


def remove_except_npy(c: &#34;Config&#34;, keep: str):
    &#34;&#34;&#34;Remove files except keep .npy files with a given word in the filename.&#34;&#34;&#34;
    keep = keep.split()
    print_w(f&#34;Removing all files in: {c.generated_data_dir()}&#34;)
    print_w(f&#34;Except files containing one of: {keep}&#34;)

    def clean_dir(dir_path):
        for root, dir_names, file_names in os.walk(dir_path):
            for file_name in file_names:
                if not (
                    any(k in file_name for k in keep) and file_name.endswith(&#34;npy&#34;)
                ):
                    print_i(f&#34;Removing {file_name}&#34;)
                    os.remove(os.path.join(root, file_name))
                else:
                    print_w(f&#34;Keeping {file_name}&#34;)
            for dir_name in dir_names:
                clean_dir(os.path.join(root, dir_name))

    clean_dir(c.generated_data_dir())


def scalar(input):
    &#34;&#34;&#34;Accepts scalars and lists of length one, returns a scalar.&#34;&#34;&#34;
    try:
        if len(input) == 1:
            return input[0]
        raise ValueError(f&#34;Not a scalar: {input}&#34;)
    except:
        return input


def safe_str(s: str) -&gt; str:
    &#34;&#34;&#34;A lowercase string with some special characters replaced.&#34;&#34;&#34;
    for char in &#34;[]()&#39;&#34;:
        s = s.replace(char, &#34;&#34;)
    s = s.replace(&#34; &#34;, &#34;-&#34;)
    s = s.replace(&#34;.&#34;, &#34;,&#34;)
    return s.lower()


def flip(l, ref):
    assert len(l) == len(ref)
    ref_zeros = len(l) - np.count_nonzero(ref)
    zeros = ref_zeros - np.count_nonzero(l[:ref_zeros])
    print(f&#34;ref_zeros, zeros = {ref_zeros}, {zeros}&#34;)
    if zeros / ref_zeros &gt;= 0.5:
        return l

    def flip_(l_):
        if l_ == 0:
            return 1
        if l_ == 1:
            return 0
        return l_

    return list(map(flip_, l))


def get_dir(directory: str):
    &#34;&#34;&#34;The given directory path but creating the directories if necessary.&#34;&#34;&#34;
    if not os.path.exists(directory):
        os.makedirs(directory)
    return directory


def plot_hours(df):
    &#34;&#34;&#34;Plot a black vertical line at every 00:00.&#34;&#34;&#34;
    label_set = False
    for dt in df[&#34;datetime&#34;]:
        if np.isclose(float(dt.hour + dt.minute), 0):
            label = None
            if not label_set:
                label = &#34;Time at vertical line = 00:00&#34;
                label_set = True
            plt.axvline(x=dt, linewidth=1, color=&#34;black&#34;, label=label)</code></pre>
</details>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-variables">Global variables</h2>
<dl>
<dt id="bridge_sim.util.kg_to_kn"><code class="name">var <span class="ident">kg_to_kn</span></code></dt>
<dd>
<div class="desc"><p>Multiply by this to convert kg to kN.</p></div>
</dd>
<dt id="bridge_sim.util.kn_to_kg"><code class="name">var <span class="ident">kn_to_kg</span></code></dt>
<dd>
<div class="desc"><p>Multiply by this to convert kN to kg.</p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="bridge_sim.util.apply"><code class="name flex">
<span>def <span class="ident">apply</span></span>(<span>effect: List[float], signal: List[float])</span>
</code></dt>
<dd>
<div class="desc"><p>Given effect interpolated to length of given signal.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>effect</code></strong></dt>
<dd>temperature effect to interpolate to signal length.</dd>
<dt><strong><code>signal</code></strong></dt>
<dd>the signal, length of which temperature is interpolated to.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply(effect: List[float], signal: List[float]):
    &#34;&#34;&#34;Given effect interpolated to length of given signal.

    Args:
        effect: temperature effect to interpolate to signal length.
        signal: the signal, length of which temperature is interpolated to.

    &#34;&#34;&#34;
    i = interp1d(
        np.linspace(0, len(signal) - 1, 10000), np.linspace(0, len(effect) - 1, 10000),
    )(np.arange(len(signal)))
    return interp1d(np.arange(len(effect)), effect)(i)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.assert_sorted"><code class="name flex">
<span>def <span class="ident">assert_sorted</span></span>(<span>l)</span>
</code></dt>
<dd>
<div class="desc"><p>Assert a list is sorted.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_sorted(l):
    &#34;&#34;&#34;Assert a list is sorted.&#34;&#34;&#34;
    assert all(l[i] &lt;= l[i + 1] for i in range(len(l) - 1))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.clean_generated"><code class="name flex">
<span>def <span class="ident">clean_generated</span></span>(<span>c: "'Config'")</span>
</code></dt>
<dd>
<div class="desc"><p>Remove generated files but keep folders.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clean_generated(c: &#34;Config&#34;):
    &#34;&#34;&#34;Remove generated files but keep folders.&#34;&#34;&#34;
    print_w(f&#34;Removing all files in: {c.generated_data_dir}&#34;)

    def clean_dir(dir_path):
        for root, dir_names, file_names in os.walk(dir_path):
            for file_name in file_names:
                print_i(f&#34;Removing {file_name}&#34;)
                os.remove(os.path.join(root, file_name))
            for dir_name in dir_names:
                clean_dir(os.path.join(root, dir_name))

    clean_dir(c.generated_data_dir())</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.convert_times"><code class="name flex">
<span>def <span class="ident">convert_times</span></span>(<span>f: str, t: str, times: List[float])</span>
</code></dt>
<dd>
<div class="desc"><p>Convert time series from one unit to another.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def convert_times(f: str, t: str, times: List[float]):
    &#34;&#34;&#34;Convert time series from one unit to another.&#34;&#34;&#34;
    second, day = &#34;second&#34;, &#34;day&#34;
    if f == day and t == second:
        return np.array(times) * 86400
    if f == second and t == day:
        return np.array(times) / 86400
    raise ValueError(f&#34;Unrecognized: {f}, {t}&#34;)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.flatten"><code class="name flex">
<span>def <span class="ident">flatten</span></span>(<span>container, t: type)</span>
</code></dt>
<dd>
<div class="desc"><p>Flatten into a list of elements of type t.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def flatten(container, t: type):
    &#34;&#34;&#34;Flatten into a list of elements of type t.&#34;&#34;&#34;

    def _flatten(container, t):
        for i in container:
            if isinstance(i, t):
                yield i
            else:
                for j in _flatten(i, t):
                    yield j

    return list(_flatten(container, t))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.flip"><code class="name flex">
<span>def <span class="ident">flip</span></span>(<span>l, ref)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def flip(l, ref):
    assert len(l) == len(ref)
    ref_zeros = len(l) - np.count_nonzero(ref)
    zeros = ref_zeros - np.count_nonzero(l[:ref_zeros])
    print(f&#34;ref_zeros, zeros = {ref_zeros}, {zeros}&#34;)
    if zeros / ref_zeros &gt;= 0.5:
        return l

    def flip_(l_):
        if l_ == 0:
            return 1
        if l_ == 1:
            return 0
        return l_

    return list(map(flip_, l))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.get_dir"><code class="name flex">
<span>def <span class="ident">get_dir</span></span>(<span>directory: str)</span>
</code></dt>
<dd>
<div class="desc"><p>The given directory path but creating the directories if necessary.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_dir(directory: str):
    &#34;&#34;&#34;The given directory path but creating the directories if necessary.&#34;&#34;&#34;
    if not os.path.exists(directory):
        os.makedirs(directory)
    return directory</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.log"><code class="name flex">
<span>def <span class="ident">log</span></span>(<span>c: "'Config'", s)</span>
</code></dt>
<dd>
<div class="desc"><p>Write a string to a log file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def log(c: &#34;Config&#34;, s):
    &#34;&#34;&#34;Write a string to a log file.&#34;&#34;&#34;
    with open(c.get_data_path(&#34;log&#34;, &#34;log.txt&#34;), &#34;a&#34;) as f:
        f.write(&#34;\n&#34; + s)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.nearest_index"><code class="name flex">
<span>def <span class="ident">nearest_index</span></span>(<span>array, value)</span>
</code></dt>
<dd>
<div class="desc"><p>Return the index of the nearest value in a sorted array.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def nearest_index(array, value):
    &#34;&#34;&#34;Return the index of the nearest value in a sorted array.&#34;&#34;&#34;
    i = np.searchsorted(array, value, side=&#34;left&#34;)
    if i &gt; 0 and (
        i == len(array) or math.fabs(value - array[i - 1]) &lt; math.fabs(value - array[i])
    ):
        return i - 1
    else:
        return i</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.plot_hours"><code class="name flex">
<span>def <span class="ident">plot_hours</span></span>(<span>df)</span>
</code></dt>
<dd>
<div class="desc"><p>Plot a black vertical line at every 00:00.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_hours(df):
    &#34;&#34;&#34;Plot a black vertical line at every 00:00.&#34;&#34;&#34;
    label_set = False
    for dt in df[&#34;datetime&#34;]:
        if np.isclose(float(dt.hour + dt.minute), 0):
            label = None
            if not label_set:
                label = &#34;Time at vertical line = 00:00&#34;
                label_set = True
            plt.axvline(x=dt, linewidth=1, color=&#34;black&#34;, label=label)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.print_d"><code class="name flex">
<span>def <span class="ident">print_d</span></span>(<span>debug: Union[bool, str], s: str, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Print some debug text.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_d(debug: Union[bool, str], s: str, *args, **kwargs):
    &#34;&#34;&#34;Print some debug text.&#34;&#34;&#34;
    if debug:
        path_str = &#34;&#34;
        if isinstance(debug, str):
            path_str = debug
        print(colored(f&#34;DEBUG: {path_str}: {s}&#34;, &#34;yellow&#34;), *args, **kwargs)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.print_i"><code class="name flex">
<span>def <span class="ident">print_i</span></span>(<span>s: str, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Print some info text.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_i(s: str, *args, **kwargs):
    &#34;&#34;&#34;Print some info text.&#34;&#34;&#34;
    print(colored(f&#34;INFO: {s}&#34;, &#34;green&#34;), *args, **kwargs)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.print_s"><code class="name flex">
<span>def <span class="ident">print_s</span></span>(<span>s: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Print some special info text.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_s(s: str):
    &#34;&#34;&#34;Print some special info text.&#34;&#34;&#34;
    print(colored(f&#34;INFO: {s}&#34;, &#34;cyan&#34;))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.print_w"><code class="name flex">
<span>def <span class="ident">print_w</span></span>(<span>s: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Print some warning text.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_w(s: str):
    &#34;&#34;&#34;Print some warning text.&#34;&#34;&#34;
    print(colored(f&#34;WARN: {s}&#34;, &#34;red&#34;))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.project_dir"><code class="name flex">
<span>def <span class="ident">project_dir</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Root directory of the project (looks for .git file).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def project_dir():
    &#34;&#34;&#34;Root directory of the project (looks for .git file).&#34;&#34;&#34;
    return os.path.dirname(findup.glob(&#34;.git&#34;))</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.remove_except_npy"><code class="name flex">
<span>def <span class="ident">remove_except_npy</span></span>(<span>c: "'Config'", keep: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Remove files except keep .npy files with a given word in the filename.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def remove_except_npy(c: &#34;Config&#34;, keep: str):
    &#34;&#34;&#34;Remove files except keep .npy files with a given word in the filename.&#34;&#34;&#34;
    keep = keep.split()
    print_w(f&#34;Removing all files in: {c.generated_data_dir()}&#34;)
    print_w(f&#34;Except files containing one of: {keep}&#34;)

    def clean_dir(dir_path):
        for root, dir_names, file_names in os.walk(dir_path):
            for file_name in file_names:
                if not (
                    any(k in file_name for k in keep) and file_name.endswith(&#34;npy&#34;)
                ):
                    print_i(f&#34;Removing {file_name}&#34;)
                    os.remove(os.path.join(root, file_name))
                else:
                    print_w(f&#34;Keeping {file_name}&#34;)
            for dir_name in dir_names:
                clean_dir(os.path.join(root, dir_name))

    clean_dir(c.generated_data_dir())</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.round_m"><code class="name flex">
<span>def <span class="ident">round_m</span></span>(<span>x)</span>
</code></dt>
<dd>
<div class="desc"><p>Round meters to an accuracy that avoids machine error.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def round_m(x):
    &#34;&#34;&#34;Round meters to an accuracy that avoids machine error.&#34;&#34;&#34;
    return np.around(x, decimals=6)</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.safe_str"><code class="name flex">
<span>def <span class="ident">safe_str</span></span>(<span>s: str) -> str</span>
</code></dt>
<dd>
<div class="desc"><p>A lowercase string with some special characters replaced.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def safe_str(s: str) -&gt; str:
    &#34;&#34;&#34;A lowercase string with some special characters replaced.&#34;&#34;&#34;
    for char in &#34;[]()&#39;&#34;:
        s = s.replace(char, &#34;&#34;)
    s = s.replace(&#34; &#34;, &#34;-&#34;)
    s = s.replace(&#34;.&#34;, &#34;,&#34;)
    return s.lower()</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.scalar"><code class="name flex">
<span>def <span class="ident">scalar</span></span>(<span>input)</span>
</code></dt>
<dd>
<div class="desc"><p>Accepts scalars and lists of length one, returns a scalar.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def scalar(input):
    &#34;&#34;&#34;Accepts scalars and lists of length one, returns a scalar.&#34;&#34;&#34;
    try:
        if len(input) == 1:
            return input[0]
        raise ValueError(f&#34;Not a scalar: {input}&#34;)
    except:
        return input</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.shorten_path"><code class="name flex">
<span>def <span class="ident">shorten_path</span></span>(<span>c: Config, filepath: str, bypass_config: bool = False) -> 'str'</span>
</code></dt>
<dd>
<div class="desc"><p>Shorten path by mapping to a shorter filepath via a metadata file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def shorten_path(c: Config, filepath: str, bypass_config: bool = False) -&gt; str:
    &#34;&#34;&#34;Shorten path by mapping to a shorter filepath via a metadata file.&#34;&#34;&#34;
    if not bypass_config and not c.shorten_paths:
        return filepath
    df_path = c.get_data_path(&#34;metadata&#34;, &#34;filepath-shortening-map.txt&#34;)
    lock_path = df_path + &#34;.lock&#34;

    # Acquire an exclusive file lock.
    with portalocker.Lock(lock_path, flags=portalocker.LOCK_EX) as f:

        def flush():
            &#34;&#34;&#34;Ensure all results are written back before exiting &#39;with&#39;.&#34;&#34;&#34;
            f.flush()
            os.fsync(f.fileno())

        if os.path.exists(df_path):
            df = pd.read_csv(df_path, index_col=0)
        else:
            df = pd.DataFrame(columns=[&#34;original&#34;, &#34;short&#34;])
        existing_row = df[df[&#34;original&#34;] == filepath]
        if len(existing_row) == 1:
            return str(existing_row[&#34;short&#34;].iloc[0])
        elif len(existing_row) &gt; 1:
            raise ValueError(f&#34;Duplicate rows in metadata file: row = {filepath}&#34;)
        short = len(df.index) + 1
        short = os.path.join(
            os.path.dirname(filepath),
            &#34;short&#34; + str(short) + os.path.splitext(filepath)[1],
        )
        if not os.path.exists(os.path.dirname(short)):
            os.makedirs(os.path.dirname(short))
        df = df.append({&#34;original&#34;: filepath, &#34;short&#34;: short}, ignore_index=True)
        df.to_csv(df_path)
        flush()
    print_i(f&#34;Shortened path to: {short}&#34;)
    return short</code></pre>
</details>
</dd>
<dt id="bridge_sim.util.st"><code class="name flex">
<span>def <span class="ident">st</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">st = lambda n: &#34;%s&#34; % (
    &#34;tsnrhtdd&#34;[(np.floor(n / 10) % 10 != 1) * (n % 10 &lt; 4) * n % 10 :: 4]
)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="bridge_sim" href="index.html">bridge_sim</a></code></li>
</ul>
</li>
<li><h3><a href="#header-variables">Global variables</a></h3>
<ul class="">
<li><code><a title="bridge_sim.util.kg_to_kn" href="#bridge_sim.util.kg_to_kn">kg_to_kn</a></code></li>
<li><code><a title="bridge_sim.util.kn_to_kg" href="#bridge_sim.util.kn_to_kg">kn_to_kg</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="bridge_sim.util.apply" href="#bridge_sim.util.apply">apply</a></code></li>
<li><code><a title="bridge_sim.util.assert_sorted" href="#bridge_sim.util.assert_sorted">assert_sorted</a></code></li>
<li><code><a title="bridge_sim.util.clean_generated" href="#bridge_sim.util.clean_generated">clean_generated</a></code></li>
<li><code><a title="bridge_sim.util.convert_times" href="#bridge_sim.util.convert_times">convert_times</a></code></li>
<li><code><a title="bridge_sim.util.flatten" href="#bridge_sim.util.flatten">flatten</a></code></li>
<li><code><a title="bridge_sim.util.flip" href="#bridge_sim.util.flip">flip</a></code></li>
<li><code><a title="bridge_sim.util.get_dir" href="#bridge_sim.util.get_dir">get_dir</a></code></li>
<li><code><a title="bridge_sim.util.log" href="#bridge_sim.util.log">log</a></code></li>
<li><code><a title="bridge_sim.util.nearest_index" href="#bridge_sim.util.nearest_index">nearest_index</a></code></li>
<li><code><a title="bridge_sim.util.plot_hours" href="#bridge_sim.util.plot_hours">plot_hours</a></code></li>
<li><code><a title="bridge_sim.util.print_d" href="#bridge_sim.util.print_d">print_d</a></code></li>
<li><code><a title="bridge_sim.util.print_i" href="#bridge_sim.util.print_i">print_i</a></code></li>
<li><code><a title="bridge_sim.util.print_s" href="#bridge_sim.util.print_s">print_s</a></code></li>
<li><code><a title="bridge_sim.util.print_w" href="#bridge_sim.util.print_w">print_w</a></code></li>
<li><code><a title="bridge_sim.util.project_dir" href="#bridge_sim.util.project_dir">project_dir</a></code></li>
<li><code><a title="bridge_sim.util.remove_except_npy" href="#bridge_sim.util.remove_except_npy">remove_except_npy</a></code></li>
<li><code><a title="bridge_sim.util.round_m" href="#bridge_sim.util.round_m">round_m</a></code></li>
<li><code><a title="bridge_sim.util.safe_str" href="#bridge_sim.util.safe_str">safe_str</a></code></li>
<li><code><a title="bridge_sim.util.scalar" href="#bridge_sim.util.scalar">scalar</a></code></li>
<li><code><a title="bridge_sim.util.shorten_path" href="#bridge_sim.util.shorten_path">shorten_path</a></code></li>
<li><code><a title="bridge_sim.util.st" href="#bridge_sim.util.st">st</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.1</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>